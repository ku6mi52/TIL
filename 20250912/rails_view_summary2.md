# Rails（レイアウトとレンダリング）

## 前提
Railsガイドを見て自分の言葉でまとめてみたいと思い、レンダーとリダイレクト中心にまとめを作成した。

## コントローラ側からみたHTTPレスポンス作成方法 
### renderを呼び出す
完全なレスポンスを作成してブラウザに送信する。renderとは、rendering(データやhtml/cssを読み込み、画面に描くこと)を実行させる命令のこと。  
`render "アクション名"`で、アクション名.html.erbテンプレートがレンダリングで使われる。レンダリングは文字列以外にシンボルでも指定可能（`render :アクション名`）。  
また、別のコントローラ配下にあるテンプレートを利用したい場合は、`render "コントローラ名/アクション名"`とする。


### redirectc_toを呼び出す
HTTPリダイレクトステータスコードをブラウザに送信する。redirectとは、現在表示中のページ(URL)から別のページ(URL)に移動させる命令のこと。  
`redirect_to hoge_url`で、現在のページからhoge_urlページに移動される。`redirect_back(fallback_location: root_path)`で、直前のページに戻る。  

### headを呼び出す
HTTPヘッダーのみのレスポンスを作成してブラウザに送信する。headメソッドを使うと、本文（body）のないヘッダのみのレスポンスをブラウザに送信できるということ。  
headメソッドの引数には、HTTPステータスコードを示すさまざまなシンボルを指定できる。オプションの引数は、ヘッダ名と値をペアにしたハッシュ値として解釈される。例：以下のコードはエラーヘッダーのみのレスポンスを返す。  
`head :bad_request`  

## レイアウトを構成する
### アセットタグ 
「フィード」「Javascript」「Stylesheet」「画像」「動画」「音声」のビューにリンクするHTMLを生成するメソッド。以下の6つのアセットタグヘルパーが利用可能。  
- `auto_discovery_link_tag`で、フィードへのリンクを生成
- `javascript_include_tag`で、JavaScriptファイルにリンクする
- `stylesheet_link_tag`で、CSSファイルにリンクする
- `image_tag`で、画像にリンクする
- `video_tag`で、動画ファイルにリンクする

### yield
yieldを使って、現在レンダリングされているビューのコンテンツ全体をその位置に挿入する。yieldをレイアウトの復数セクションに配置することも可能。ビューのメインbodyは、常に「名前のない」yieldの位置でレンダリングされる。コンテンツを名前付きyieldの位置でレンダリングするには、content_forメソッドを使う。  
```
<html>
  <head>
    <%= yield :head %>
  </head>
  <body>
    <%= yield %>
  </body>
</html>
```

### content_for
レイアウトの名前付きyieldブロックの位置にコンテンツを挿入できる。レイアウトにサイドバーやフッターなど、独自のコンテンツブロックを挿入する必要がある個別の領域が含まれている場合に便利。ページ固有のJavaScript <script>要素、CSS <link>要素、コンテキスト固有の<meta>要素などの要素を、それ以外の一般的なレイアウトの<head>に挿入する場合にも便利。

### パーシャル（部分テンプレート）
`<%= render "部分テンプレート名" %>`というrenderメソッドによって、_部分テンプレート名.html.erbファイルが同じフォルダ内で検索され、そのビュー内でレンダリングされる。  
パーシャルファイル名には_(アンダースコア)を先頭につけるが、レンダリングするパーシャルをビュー内で参照するときは_(アンダースコア)をつけない。  
また、別ディレクトリにあるパーシャルを参照する場合は、`<%= render "application/部分テンプレート名" %>`とする。

## 参考
<a>https://railsguides.jp/layouts_and_rendering.html#render%E3%83%A1%E3%82%BD%E3%83%83%E3%83%89%E3%82%92%E4%BD%BF%E3%81%86</a>

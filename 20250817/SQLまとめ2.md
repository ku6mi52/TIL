# SQLまとめ2

## 1.概要・学習目的  
概要：ProgateのSQL（III, IV）のまとめ  
目的：データベースを扱う言語を習得する

## 2.基本文法・ポイント  
### サブクエリとは
クエリの中に入った他のクエリ。1つのクエリよりも、複雑なデータを取得するときに使われる。  
```
SELECT カラム名1
FROM テーブル名
WHERE 条件 (
  SELECT カラム名2
  FROM テーブル名2
  WHERE 条件
);
```

サブクエリを含むクエリは、サブクエリ実行後、外側のクエリが実行される。  

### ASとは
カラム名に別名を定義できる。「SELECT カラム名 AS "別名"」  

### テーブルを関連付ける
- 主キー(id) 
- 外部キー  

テーブルを関連付けるには、外部キーで他のテーブルにある主キーを指定する。カラムを追加するのではなく、テーブル同士を関連付けると、変更の際にデータ管理しやすくなる。  

### テーブルの結合 
紐づいたテーブル同士は、JOINを使うと結合できる。結合したテーブルは、1つのテーブルと同じようにデータ取得できる。
JOINは、復数のテーブルを1つに結合したいときに使う。ONで結合条件を指定して、テーブルAにテーブルBを結合する。  
```
SELECT *
FROM テーブルA
JOIN テーブルB
ON テーブルA.外部キーカラム名 = テーブルB.主キーカラム名 
```

JOINを含んだクエリでは、JOIN →  結合されたテーブルに対してSELECT の実行順序。  
3つ以上のテーブルを結合させる場合も、JOINとONを繰り返して書けばよい。（FROMは一度書けばOK）  

#### LEFT JOIN
JOINでは、外部キーがNULLのレコードは実行結果に表示されない。そのため、NULLのレコードも取得したい場合は、「LEFT JOIN」を使う。  
「LEFT JOIN」は、FROMで指定したテーブルのレコードをすべて取得する。＝外部キーがNULLのレコードもNULLのまま実行結果に反映される。

### 復数テーブルでのカラム指定
復数のテーブルに同じカラム名が存在するときは、SELECTやWHEREで「それぞれのテーブル名.カラム名」と指定する。

### クエリ全体の実行順序
1. テーブルの指定「FROM」  
2. 結合「ON・JOIN」  
3. 取得条件「WHERE」  
4. グループ化「GROUP BY」  
5. 関数  
6. HAVING (グループ化されたデータが対象)  
7. 検索「SELECT・DISTINCT」  
8. 順序「ORDER BY」  
9. LIMIT  

### データの追加
テーブルにレコードを挿入するときは「INSERT」を使う。idカラムには自動で値が割り振られる「AUTO INCREMENT」機能が使われる。
```
INSERT INTO テーブル名 (カラム1, カラム2) VALUES (〇〇, 〇〇);
```

### データの更新   
```
UPDATE テーブル名 
SET カラム1=〇〇, カラム2=〇〇
WHERE id = 数値;
```

復数変更したいカラムがある場合は、コンマで区切る。
指定カラムを新しい値に変更した後、更新するレコードをWHEREで指定する。WHEREでid指定をしないと、カラム内の全データが更新されてしまう。    
UPDATE実行後はデータを戻すことができないため、実行前に一度SELECTを実行して、操作するデータか確認する。

### データの削除
```
DELETE FROM テーブル名
WHERE id=数値;
```

UPDATEと同様に、クエリ実行後はレコードをもとに戻せないので、SELECTでレコードを確認してから削除を行う。

## 3.エラー・詰まった点  
特になし  

## 4.気づき・メモ  
- テーブルを結合すると、変更があるときに一箇所しか変更する必要がないから便利
- データの取得「SELECT カラム名 FROM テーブル名」  
- データの挿入「INSERT INTO テーブル名 (カラム名, カラム名) VALUES (値, 値)
- データの更新「UPDATE テーブル名 SET カラム=値, カラム=値 WHERE 条件」
- データの削除「DELETE FROM テーブル名 WHERE 条件」

## 5.次にやること  
- テーブル図・ER図

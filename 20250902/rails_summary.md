# Ruby on railsのまとめpart1

## Railsアプリケーションの作成

「rails new アプリケーション名」

入力したアプリケーション名と同名のディレクトリが作成され、さらにそのディレクトリ内に、開発に必要なディレクトリとファイルが自動で作成される（以下）。

| ファイル/フォルダ | 目的 |
| --- | --- |
| app/ | アプリケーションのメインディレクトリ。コントローラ、モデル、ビュー、ヘルパー、メーラー、ジョブ、アセットが置かれる。 |
| bin/ | アプリケーションを起動するrailsスクリプトが置かれるディレクトリ。セットアップ、アップデート、デプロイに使うスクリプトファイルも置ける。 |
| config/ | 設定情報（ルーティング、データベース）に関するディレクトリ。 |
| config.ru | Rackベースのサーバーでアプリケーションの起動に使われるRack設定ファイル。 |
| db/ | データベースに関するディレクトリ。現在のデータベーススキーマとデータベースマイグレーションファイルが置かれる。 |
| Dockerfile | Dockerの設定ファイル。 |
| Gemfile
Gemfile.lock | Railsアプリケーションで必要となるgemの依存関係を記述するファイル。Bundler gemで使われる。 |
| lib/ | 拡張モジュールが置かれるディレクトリ。 |
| log/ | アプリケーションのログファイルが置かれるディレクトリ。 |
| public/ | 静的なファイルやコンパクト済みアセットが置かれるディレクトリ。ここにあるファイルは外部（インターネット）にそのまま公開される。 |
| Rakefile | コマンドラインから実行できるタスクを探索して読み込むファイル。 |
| README.md | アプリケーションの概要を簡潔に記入するマニュアルを記入するファイル。 |
| script/ | 使い捨てまたは汎用可能なスクリプトやベンチマークを置くディレクトリ。 |
| storage/ | ディスクサービス用のSQLiteデータベースファイルやActive Storageファイルが置かれるディレクトリ。 |
| test/ | 単体テストやフィクスチャなどのテスト関連ファイルが置かれるディレクトリ。 |
| tmp/ | キャッシュやpidなどの一時ファイルが置かれるディレクトリ。 |
| vendor/ | サードパーティ製コードが置かれるディレクトリ。外部のgemファイルが置かれる。 |
| .dockerignore | コンテナにコピーすべきでないファイルをDockerに指示するのに使うファイル。 |
| .gitattributes | gitリポジトリ内の特定のパスについてメタデータを定義するファイル。このメタデータは、gitや他ツールで振る舞いを拡張できる。 |
| .github/ | GItHub固有のファイルが置かれるディレクトリ。 |
| .gitignore | gitに登録しないファイル（またはパターン）を指定するファイル。 |
| .kamal/ | Kamelの秘密鍵とデプロイ用フックが含まれるディレクトリ。 |
| .rubocop.yml | RuboCop用の設定が含まれるファイル。 |
| .ruby-version | デフォルトのRubyバージョンが記述されているファイル。 |

## 開発中のアプリをブラウザ表示（サーバー起動）

「rails server」

サーバーを起動後、ブラウザで「localhost:3000」というURLにアクセスする。

## トップページを自動生成

「rails g controller home top」

（ページを作成「rails g controller コントローラ名 アクション名」※同じ名前のコントローラがすでにある場合は、このコマンドを使うことはできない！）

→ localhost:3000/home/topにアクセスできるようになる。

→ 以下のディレクトリとファイルが作成される。

- app/views/home/top.htme.erb  （ビュー）
- app/controllers/home_controller.rb  （コントローラ）
- config/routes.rb  （ルーティング）
- app/assets/stylesheets/home.scss  （CSS）
- app/assets/images  （画像フォルダ）
- app/assets/javascripts  （JS）

## ページの追加

すでに作られているルーティングとコントローラのファイルにコードを書き足すことで、ルーティングとアクションを追加できる。ビューは、app/views/homeディレクトリの中にファイル（〇〇.html.erb）を手動で新規作成する。

ルーティング（routes.rb）

```ruby
Rails.application.routes.draw do
	get "top" => "home#top"
	get "〇〇" => "home#〇〇"
end
```

コントローラ（home_controller.rb）

```ruby
class HomeController < ApplicationContorol[48;25;80;850;1120tler
	def top
	end
	def 〇〇
	end
end
```

このように、ルーティング→コントローラ→ビューの順で作成していく。

まず、ルーティングでアクションを指定し、コントローラで指定アクションを作成する。最後に、該当ページのビューを作成し、ブラウザでアクセス確認する。

## ページの見た目部分

### CSS

「rails g controller home top」で自動生成されるCSSファイル（home.scss）の「scss」はCSSを拡張したもので、CSSを効率的に書く文法も使用できる。「stylesheets」フォルダの中に保存されているCSSファイルにコードを書けば、すべてのビューにCSSが適用される。

### 画像の追加

画像は、「public」フォルダ（public/〇〇.jpgなど）に配置しておくと、「<img src="/画像名" >」や「background-image: url("/画像名");」のように、画像名を指定するだけで、簡単に画像を表示することができる。

画像URLをCSSに書く場合は、「意味のないもの（ボタンのアイコン、背景パターン、デコレーションなど）」として扱う場合で、HTMLに書く場合は「意味のあるコンテンツ（商品写真、プロフィール画像、グラフなど）として扱う場合。

## URLの変更

### **localhost:3000でトップページが表示されるようにする**

routes.rb

```ruby
Rails.application.routes.draw do
	get "/" => "home#top"
end
```

home_controller.rb

```ruby
class HomeController < ApplicationController
	def top
	end
end
```

## リンク作成

- <a>タグでテキストを囲み、「href=" "」の中にルーティングのURL部分と同じURLを指定する。ビューファイルで、<a href=”/”>〇〇</a>、<a href=”URL>ほにゃらら</a>など。
- <%= link_to(”第一引数”, “第二引数”) %>のように、Railsでは、Rubyのlink_toメソッドを使うと<a>タグを作成できる。第一引数には表示する文字、第二引数にはURLを書くとリンクが作成される。

### 共通のレイアウトをまとめる

views/layouts/application.html.erbに、サイト全体に適用される共通のHTMLをまとめて書いておける。

## 目的に合わせてコントローラを作成

コントローラの作成「rails g controller コントローラ名 アクション名」

### HTMLファイルにRubyを埋め込む

「erb」とは「Embedded Ruby（埋め込みRuby）」の略。<% %>で囲むとRubyを埋め込める。<%= %>でRubyコードの中身を表示できる。

しかし、表示の数だけ変数とHTMLを書くのは大変なので、ビューファイルで、<% %>などを用いながら以下の2ステップを実行する。

- それぞれの変数を1つの配列にまとめる
- 配列の中身をeach文で1つずつ取り出す

さらに、ビューで使う変数は、アクション内で定義することが一般的である。（def アクション名 @変数名 変数定義 end）変数名を「@」から始めることでこの変数は特殊な変数となり、ビューファイルでも使用可能になる。ビューで、アクションで定義した変数を呼び出す際も変数名に@をつける。

## DBテーブル作成

1. DBに変更を指示するためのファイル（マイグレーションファイル）を作成
2. DBに変更を反映

1.マイグレーションファイルの作成「rails g model モデル名 カラム名:データ型」

→ db/migrate/フォルダ下にマイグレーションファイルが作成

→ app/models/モデル名単数形.rb（モデルが定義されたファイル）が作成

ファイルの中には、ApplicationRecordクラスを継承するクラスが定義されている。ApplicationRecordを継承したクラスをモデルと呼ぶ。

2.DBに変更を反映「rails db:migrate」

→ マイグレーションファイルに書かれた指示通りにテーブル作成

（テーブル作成時に、指示したカラム以外に、id, created_at, updated_atという3カラムが自動生成）

※Railsでは、DBに反映されていないマイグレーションファイルが存在する状態でどこかのページにアクセスすると、マイグレーションエラーが発生する。だから、マイグレーションファイルを作成したら、必ずrails db:migrateを実行する。

## テーブル操作

テーブルを操作するためのモデルと呼ばれる特殊なクラス（設計図）を用いて、DBを使う。

```bash
Rubyコード実行環境「rails console」
コンソール終了「quit」
```

### テーブルにデータを追加

1. newメソッドでモデルのインスタンスを作成
2. テーブルに保存

1.「rails console」→「変数名 = モデル名.new(型: “ “)」

型が” “であるモデルインスタンスを作成。

2.作成したモデルインスタンスをテーブルに保存「変数名.save」

DBに保存される。

### テーブルからデータを取得

- テーブルにある最初のデータを取得「変数名 = モデル名.first」
- 上記で取得したデータのカラムごとの内容を取得「変数.カラム名」
- すべてのデータを取得「テーブル名複数形 = モデル名.all」
- 上記の配列から1つのデータ（インデックス番号が0のデータ）を取得「テーブル名複数形 = モデル名.all[0]」。このとき取得したデータは、モデル名.firstで取得したデータと同形のデータのため、「モデル名.all[0].カラム名」で、カラムごとのデータ内容を取得可能。
- 特定のidからデータ取得「変数 = モデル名.find_by(id:1)」のように、「モデル名.find_by(カラム名: 値)」
- 作成時刻を取得「変数名.created_at」

### テーブルから取得したデータをビューに表示

コントローラのアクション内の@変数に、モデル名.allで取得したデータを代入する。

ビューでは、@変数に代入されている配列データをeach文で1つずつ変数に代入し、内容を繰り返し表示させる。

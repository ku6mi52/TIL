# Railsテーブル作成手順書  

## 1.モデルとマイグレーションの作成  
`rails g model モデル名 カラム名:型`  
間違えた場合は、`rails d model モデル名`で削除。  

コマンド実行後、以下のファイルが自動生成される。  
- モデルのクラスファイル（app/model）  
- 指定付きマイグレーションファイル（db/migrate）  
- テスト系ファイル（モデルクラスのテスト用ファイル、テストデータを投入するためのファイル）  

## 1.マイグレーションファイルの編集  
生成されたマイグレーションファイルを修正し、必要に応じてテーブルの中のカラムを追加・変更する。  
カラムには、id、created_at(作成日時)、update_at(更新日時)は自動で設定されるため、改めてここで設定する必要はない。  
`rails g migration Addカラム名Toテーブル名 カラム名:型`  
削除したい場合は、AddをRemoveに変える。`rails g migration Removeカラム名Fromテーブル名 カラム名：型`  

### テーブルの指定できる型 
- string : 文字列(1 〜 255文字)  例...名前、住所、パスワードなど。
- text : 長い文字列(1 〜 4,294,967,296文字)  例...コメント、投稿文など。  
- integer : 整数型(4バイト)
- bigint：整数型(8バイト)  railsのid（主キー）はデフォルトでbigint。
- float : 浮動小数
- decimal : 精度の高い小数
- datetime : 日付と時刻(1000-01-01 00:00:00.000000 〜 9999-12-31 23:59:59.999999)
- timestamp : 日付と時刻('1970-01-01 00:00:01' UTC ~ '2038-01-19 03:14:07' UTC)  ※2038年までしか対応していない 
- time : 時間のみ 
- date : 日付のみ
- binary : バイナリデータ(データが「0」と「1」で表現されているデータ形式)。＝テキストではない情報でデータが書かれているファイル。音声ファイル、画像ファイル、圧縮ファイルなど。
- boolean : 真偽値(true/false)


## 2.モデルファイルを編集  
生成されたモデルファイルを編集して制約などを設定する。  
has_oneなどの設定は、作成したテーブルを他テーブルと関連付けたい時に設定する。  

- has_one・・・他テーブルとの関連の対象が１つ（単数形で記述）  
- has_many・・・他テーブルとの関連の対象が複数（複数形で記述）  
- belongs_to・・・このテーブルが他テーブルに所属している（単数形で記述）  

あとは、validateなどの制約設定があれば記述する。

## 3.マイグレーションを実行してDBに反映  
`rails db:migrate`  
上記のマイグレーション実行コマンドによって、マイグレーションファイルに設定した内容で、テーブルとカラムが実際に作成される。

## 4.マイグレーション実行後の変更  
カラムなどを変更したい場合、`rails db:migrate:status`でマイグレーションのバージョンを確認後、`rails db:rollback STEP=1`でDBの状態を最新のマイグレーションファイルを実行する前に戻す。  
STEP=1は、1つ前のバージョンに戻すという意味。もしくは、`rails db:rollback VERSION=YYYYMMDDXXXXX`で戻したいバージョンのmigration idを指定する。  
コマンド実行後、マイグレーションファイルを編集し、再度`rails db:migrate`で変更した内容でマイグレーション実行する。

## 参考
<a>https://qiita.com/aisplay/items/39643ee02f5dfabc2551</a>    
<a>https://qiita.com/you8/items/32f9799e79b9941dd01a</a>  
<a>https://qiita.com/jackie0922youhei/items/472ae8a35455475b3de8</a>
